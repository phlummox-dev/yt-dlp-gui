
Notes on internals, developer setup, and design decisions.

## setup

Run `scripts/install-hooks.sh` to set up some commit hooks that protect the package
`__init__.py` file, containing app metadata. It generally shouldn't be edited, just
overwritten by CI/CD scripts at build time.

## PyInstaller `.spec` Files

This project commits PyInstaller `.spec` files to version control. The intent is that these files
define the current, tested configuration used to build executables.

- The committed `.spec` files serve as the canonical build configuration to ensure reproducible and
  consistent builds.
- PyInstaller builds can be fragile and prone to subtle bugs, so the hope is that maintaining `.spec`
  files will help avoid build drift.

If you need to regenerate a `.spec` file (e.g., after changing the source layout), run:

```
  make regenerate-spec
```

This will produce a fresh `.spec` file which you can review and edit as necessary before committing.

Manual edits to `.spec` files are expected for tasks like adding data files, hidden imports, or tweaking build options.
After editing, verify your changes by rebuilding the executable and testing it.

Suggested protocol for using the `.spec` file is - near the top, record how it was generated (e.g. any
changes you made to command-line options), and the PyInstaller version used to generate the file (can help troubleshoot build quirks).
e.g.

```
  # Generated by:
  # pyinstaller --onefile --name=MyApp [.. other options here ..]
  # Regenerate with that command or: `make regenerate-spec`
  # PyInstaller version: 6.13.0
```

If you make manual edits, add comments in the `.spec` file explaining why - e.g.:

```
  # Manual edits:
  # - Added hiddenimports=['foo'] to fix runtime import errors
  # - Included data files in datas=[('data/', 'data/')]
```

## CI/CD pipelines

We build executables using pyinstaller - mostly for the benefit of Windows users who don't have
Python installed.

Other users (MacOS, Linux) should generally be able to install Python easily enough, but we
supply executables anyway. (TODO: Probably an AppImage or flatpak would be better.)

For linux - to create a portable, packed executable with pyinstaller, we need a low version of
GNU libc, so it's compatible with most users' platforms; but we also want a fairly recent version
of Python.

The GNU libc in GitHub's Ubuntu runners are all too recent, so we build in a docker image based on
Debian bullseye (uses glibc 2.31, released Feb 2020).




